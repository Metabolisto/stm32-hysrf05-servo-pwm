# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–æ–º MG90S 360¬∞ –Ω–∞ STM32 –ø–æ –¥–∞–Ω–Ω—ã–º —É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–≥–æ –¥–∞—Ç—á–∏–∫–∞.

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –≤—Ä–∞—â–µ–Ω–∏—è —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–∞ MG90S 360¬∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π —É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–≥–æ –¥–∞—Ç—á–∏–∫–∞ HY-SRF05, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω–æ–≥–æ –∫ STM32F103C8T6 (Blue Pill). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –®–ò–ú —Å —É—Ä–æ–≤–Ω–µ–≤—ã–º —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ–º (3.3–≤ - 5–≤) —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä C1815.

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–∞—â–µ–Ω–∏–µ–º —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–∞ MG90S(–≤–ø–µ—Ä—ë–¥/–Ω–∞–∑–∞–¥)  
- –ú–µ–¥–∏–∞–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —à—É–º–æ–≤  
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –®–ò–ú-—Å–∏–≥–Ω–∞–ª–∞ 1300‚Äì1700 –º–∫—Å  
- –§–∏–∫—Å–∞—Ü–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –¥–∞—Ç—á–∏–∫–∞ HY-SRF05  
- –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π —Å–∏–≥–Ω–∞–ª–∞ (3.3–í ‚Üí 5–í) —Å –ø–æ–º–æ—â—å—é C1815  

---
## üìê –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç           | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                             |  
|---------------------|----------------------------------------|  
| STM32F103C8T6       | –ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ("Blue Pill")          |  
| HY-SRF05            | –£–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–π –¥–∞—Ç—á–∏–∫ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è       |  
| MG90S 360¬∞          | –°–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è      |  
| C1815 (NPN)         | –¢—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä –¥–ª—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ PWM         |  
| –†–µ–∑–∏—Å—Ç–æ—Ä—ã 1–∫, 4.7–∫Œ© | –ë–∞–∑–∞ –∏ –ø–æ–¥—Ç—è–∂–∫–∞ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞             |  

---
## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ         | –ü–∏–Ω STM32        | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ                    |  
|--------------------|------------------|-------------------------------|  
| TRIG (HY-SRF05)    | PA0              | –í—ã—Ö–æ–¥                         |  
| ECHO (HY-SRF05)    | PA1              | –í—Ö–æ–¥, —É—Ä–æ–≤–µ–Ω—å 5–í              |  
| PWM (–∫ –±–∞–∑–µ C1815) | PA7 (TIM3_CH2)   | –ß–µ—Ä–µ–∑ 1–∫–û–º —Ä–µ–∑–∏—Å—Ç–æ—Ä           |  

**–°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (NPN —Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä C1815 –∫–∞–∫ –±—É—Ñ–µ—Ä –®–ò–ú)**  
```
STM32 PA7 (PWM)
    ‚îÇ
   1kŒ©
    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ –ë–∞–∑–∞ —Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä–∞ C1815 (NPN)


–ö–æ–ª–ª–µ–∫—Ç–æ—Ä ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ –°–∏–≥–Ω–∞–ª—å–Ω—ã–π (–æ—Ä–∞–Ω–∂–µ–≤—ã–π) –ø—Ä–æ–≤–æ–¥ MG90S
          ‚îÇ     
        4.7kŒ©  
          ‚îÇ     
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫5V    

–≠–º–∏—Ç—Ç–µ—Ä ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ GND
```
üîß –¢–∞–∫–∞—è —Å—Ö–µ–º–∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç 3.3–í –®–ò–ú –æ—Ç STM32 –¥–æ 5–í, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã MG90S 360¬∞. MG90S –ø–∏—Ç–∞–µ—Ç—Å—è –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è: 5–í(–∫—Ä–∞—Å–Ω—ã–π), GND(–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π).
‚ö†Ô∏è **–í–∞–∂–Ω–æ**:
HY-SRF05 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∏–≥–Ω–∞–ª 5–í –Ω–∞ ECHO, –∞ STM32F103C8T6 —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª–æ–≥–∏–∫–æ–π 3.3–í, –ø–æ—ç—Ç–æ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –¥–µ–ª–∏—Ç–µ–ª—è:
```
HY-SRF05 ECHO
 ‚îÇ
 ‚îî‚îÄ‚îÄ‚îÄ‚ñ∫ 1 –∫–û–º ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚ñ∫ PA1 (STM32, –≤—Ö–æ–¥ 3.3–í)
                ‚îÇ
               2 –∫–û–º
                ‚îÇ
               GND
```
–†–∞—Å—á—ë—Ç:  
Vout = Vin * R2/(R1+R2);  
Vstm = 2/(1+2)*5 = 3.33–í;  
–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—ã–µ —Ä–µ–∑–∏—Å—Ç–æ—Ä—ã —Å —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º 1:2, –Ω–∞–ø—Ä–∏–º–µ—Ä:  
 - 470 –û–º + 1 –∫–û–º;  
 - 1 –∫–û–º + 2 –∫–û–º;  
 - 2.2 –∫–û–º + 4.7 –∫–û–º;  
(–≥–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–æ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ –Ω–∞–≥—Ä—É–∂–∞—Ç—å –≤—ã—Ö–æ–¥ HY-SRF05)  
–î–µ–ª–∏—Ç–µ–ª—å –∏–∑ 1 –∫–û–º –∏ 2 –∫–û–º –ø–æ–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –¥–æ ‚âà3.3 –í, —á—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è STM32.  

- [–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ST-LINK V2](https://github.com/user-attachments/assets/11cf20ef-1757-43f4-bd80-f0e9caa32841)

---
## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
stm32-hcsr04-servo-pwm/
‚îú‚îÄ‚îÄ Core/                       # –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ ‚îú‚îÄ‚îÄ Inc/                      # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã (.h)
‚îÇ ‚îî‚îÄ‚îÄ Src/                      # –ò—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã (.c)
‚îú‚îÄ‚îÄ Drivers/                    # HAL –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îú‚îÄ‚îÄ .gitignore                  # –ò—Å–∫–ª—é—á–µ–Ω–∏—è Git
‚îú‚îÄ‚îÄ Servo SG90 and HY-SRF05.ioc # STM32CubeMX —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---
## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–∏—Ñ–µ—Ä–∏–∏ –≤ STM32CubeMX:

|–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è |                –ù–∞—Å—Ç—Ä–æ–π–∫–∏                     |  
|----------|----------------------------------------------|  
|TIM3      |CH2 (PA7) ‚Äî PWM (Prescaler: 71,Period:20000-1)|   
|GPIO      |TRIG (PA0) ‚Äî Output Push-Pull                 |  
|GPIO      |ECHO (PA1) ‚Äî Input (no pull / pull-down)      |  

---
## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã
1. –ö–∞–∂–¥—ã–µ 100 –º—Å –∏–∑–º–µ—Ä—è–µ—Ç—Å—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–º–µ–¥–∏–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –∏–∑ 5 –∑–Ω–∞—á–µ–Ω–∏–π)    
2. –ó–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —à–∏—Ä–∏–Ω—É –∏–º–ø—É–ª—å—Å–∞ –®–ò–ú:  
 - distance = 0 ‚Üí pwm = 1400 –º–∫—Å  
 - distance = 25 ‚Üí pwm = 1500 –º–∫—Å (—Å—Ç–æ–ø)  
 - distance = 50 ‚Üí pwm = 1600 –º–∫—Å  
3. –®–ò–ú –ø–æ—Å—Ç—É–ø–∞–µ—Ç –Ω–∞ PA7 ‚Üí C1815 ‚Üí —Å–∏–≥–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≤–æ–¥ MG90S  

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –∏–∑–º–µ—Ä–µ–Ω–∏–µ**

### `getDistance()`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—é—â–∏–π –∏–º–ø—É–ª—å—Å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 10 –º–∫—Å
- –û–∂–∏–¥–∞–µ—Ç —ç—Ö–æ-—Å–∏–≥–Ω–∞–ª–∞ —Å –ø–æ–º–æ—â—å—é —Ç–∞–π–º–µ—Ä–∞ DWT
- –í–∫–ª—é—á–∞–µ—Ç —Ç–∞–π–º-–∞—É—Ç (~100 –º—Å), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤—Ä–µ–º—è –ø–æ–ª–µ—Ç–∞ –≤ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–∞—Ö

### `GetFilteredDistance()`
- –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç 5 –≤—ã–±–æ—Ä–æ–∫
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç **–º–µ–¥–∏–∞–Ω–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é** –¥–ª—è –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è —à—É–º–æ–≤
- –°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –®–ò–ú

---
## ‚ÑπÔ∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
 - MG90S 360¬∞ **–Ω–µ** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å.  
 - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DWT-—Ç–∞–π–º–µ—Ä –¥–ª—è –∑–∞–¥–µ—Ä–∂–µ–∫ –≤ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞—Ö.  
 - –¢–∞–π–º–∞—É—Ç—ã –≤ GetDistance() –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π.  

---
## ‚öôÔ∏è –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
1. –û—Ç–∫—Ä–æ–π .ioc –≤ STM32CubeIDE  
2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∏ —Å–æ–±–µ—Ä–∏ –ø—Ä–æ–µ–∫—Ç (`Ctrl + B`)  
3. –ü—Ä–æ—à–µ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —á–µ—Ä–µ–∑ ST-Link  
4. –ü–æ–¥–∫–ª—é—á–∏ —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥ –∏ –¥–∞—Ç—á–∏–∫ –ø–æ —Å—Ö–µ–º–µ –≤—ã—à–µ  
5. –ù–∞–±–ª—é–¥–∞–π –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–∞ –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ —É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–º—É –¥–∞—Ç—á–∏–∫—É —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

---
## üé• –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –≤–∏–¥–µ–æ
- [–§–æ—Ç–æ](https://github.com/user-attachments/assets/dcc48239-343f-42b0-9f82-14d549f34399)
- [–§–æ—Ç–æ](https://github.com/user-attachments/assets/dedda390-5166-4c29-be87-d3cdb2024f09)
- [–í–∏–¥–µ–æ](https://youtube.com/shorts/hdxZxFY5Pmg?feature=share)